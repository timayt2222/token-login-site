<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Alts Hosting - Dashboard</title>

<!-- Lucide icons script -->
<script src="https://unpkg.com/lucide@latest/dist/lucide.min.js"></script>

<style>
  :root {
    --bg-light: #f7faff;
    --bg-dark: #111827;
    --text-light: #1f2937;
    --text-dark: #e5e7eb;
    --muted-light: #6b7280;
    --muted-dark: #9ca3af;
    --primary: #2563eb;
    --primary2: #1d4ed8;
    --primary-glow: 0 0 12px rgba(37,99,235,0.45);
    --border-light: #e5e7eb;
    --border-dark: #374151;
    --danger: #dc2626;
  }
  
  *{box-sizing:border-box;}

  body {
    margin: 0;
    font-family: ui-sans-serif, system-ui, sans-serif;
    background: var(--bg-light);
    color: var(--text-light);
    transition: background .2s, color .2s;
  }
  
  body.dark {
    background: var(--bg-dark);
    color: var(--text-dark);
  }
  
  .screen{ display:none;}
  .screen.active{ display:block;}

  /* GENERAL BUTTONS */
  button {
    cursor: pointer;
    border: none;
    border-radius: 12px;
    padding: 10px 16px;
    font-weight: 800;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: .15s;
  }
  button:hover{ transform: translateY(-2px); }
  
  .btn-primary {
    background: var(--primary);
    color: #fff;
    box-shadow: var(--primary-glow);
  }
  .btn-primary:hover {
    background: var(--primary2);
  }
  
  .btn-ghost {
    background: #fff;
    border: 1px solid var(--border-light);
    color: var(--text-light);
  }
  body.dark .btn-ghost {
    border: 1px solid var(--border-dark);
    color: var(--text-dark);
  }

  .btn-danger {
    background: #fff;
    border: 1px solid rgba(220,38,38,0.35);
    color: var(--danger);
  }

  .status { margin-top: 10px; font-weight: 700; color: var(--muted-light);}
  body.dark .status{ color: var(--muted-dark);}

  .wrap {
    max-width: 980px;
    margin: 0 auto;
    padding: 28px 18px;
  }

  .login-card {
    border: 1px solid var(--border-light);
    border-radius: 16px;
    padding: 22px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.08);
    background: #fff;
  }
  body.dark .login-card {
    border: 1px solid var(--border-dark);
    background: #374151;
  }

  .title{ font-size: 24px; font-weight:900; margin-bottom:8px;}
  .tab { display:flex; gap:12px; margin-bottom:16px;}
  .tab button { font-size:16px;}

  textarea, input {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--border-light);
    border-radius: 10px;
    font-size: 14px;
    margin-top: 6px;
  }
  body.dark textarea, body.dark input {
    border: 1px solid var(--border-dark);
    background: #1f2937;
    color: var(--text-dark);
  }

  .dashboard-top { display:flex; justify-content: space-between; align-items:center;}
  .file-list {margin-top:12px; list-style:none;padding:0;}
  .file-list li{
    padding: 8px 0;
    border-bottom:1px solid var(--border-light);
    display:flex;
    align-items:center;
    gap:8px;
  }
  body.dark .file-list li{ border-bottom:1px solid var(--border-dark);}

  .drop-zone {
    margin-top: 18px;
    border: 2px dashed var(--border-light);
    padding: 28px;
    border-radius: 14px;
    text-align: center;
    color: var(--muted-light);
    cursor: pointer;
    transition: .2s;
  }
  body.dark .drop-zone {
    border: 2px dashed var(--border-dark);
    color: var(--muted-dark);
  }
  .drop-zone:hover {
    background: rgba(37,99,235,0.06);
  }
  
</style>
</head>
<body>

<div class="wrap">

  <!-- AUTH SCREEN -->
  <div id="authScreen" class="screen active">
    <div class="login-card">
      
      <div class="dashboard-top" style="margin-bottom:14px;">
        <div class="title">Access Portal</div>
        <button id="themeToggle">
          <i data-lucide="moon"></i>
        </button>
      </div>
      
      <div class="tab">
        <button id="tabRegBtn" class="btn-primary">Register</button>
        <button id="tabLoginBtn" class="btn-ghost">Log In</button>
      </div>

      <div id="regForm">
        <button id="genTokenBtn" class="btn-primary" style="width:100%;">
          <i data-lucide="circle-pound-sterling"></i>
          Generate Token
        </button>
        <div id="regStatus" class="status"></div>
        <textarea id="regTokenShow" readonly style="margin-top:12px; display:none;"></textarea>
        <div style="margin-top:10px; display:flex; gap:10px;">
          <button id="copyTokenBtn" class="btn-ghost" disabled>
            <i data-lucide="clipboard"></i> Copy Token
          </button>
          <button id="downloadTokenBtn" class="btn-ghost" disabled>
            <i data-lucide="download"></i> Download .txt
          </button>
        </div>
      </div>

      <div id="loginForm" style="display:none;">
        <div class="status">Enter token to login:</div>
        <textarea id="loginTokenInput"></textarea>
        <button id="loginBtn" class="btn-primary" style="margin-top:12px;">
          <i data-lucide="log-in"></i> Log In
        </button>
        <div id="loginStatus" class="status"></div>
      </div>

    </div>
  </div>

  <!-- DASHBOARD SCREEN -->
  <div id="dashScreen" class="screen">
    <div class="dashboard-top">
      <div>
        <div class="title">My Project Dashboard</div>
        <div class="status" id="dashWelcome"></div>
      </div>
      <button id="themeToggle2">
        <i data-lucide="moon"></i>
      </button>
    </div>

    <!-- File upload + list -->
    <div>
      <button class="btn-primary glow" id="uploadBtn">
        <i data-lucide="upload-cloud"></i>
        Upload Files
      </button>
      <ul class="file-list" id="fileList"></ul>

      <div class="drop-zone" id="dropZone">
        <i data-lucide="file-plus"></i><br>
        Drag & drop files here or click to browse
      </div>
      <input type="file" id="fileInput" multiple style="display:none;">
    </div>

    <!-- Delete account -->
    <div style="margin-top:24px; border-top:1px solid var(--border-light); padding-top:18px;">
      <div class="status">Danger zone:</div>
      <input type="text" id="deleteConfirm" placeholder="Type Delete Account to confirm">
      <button class="btn-danger" id="delAccBtn">
        <i data-lucide="trash"></i> Delete Account
      </button>
      <div id="delStatus" class="status"></div>
    </div>
  </div>

</div>

<script>
  // INIT LUCIDE
  lucide.replace({width:20, height:20});

  // THEME
  const themeToggle = document.querySelectorAll("#themeToggle, #themeToggle2");
  const bodyEl = document.body;
  const storedTheme = localStorage.getItem("themeMode");
  if(storedTheme==="dark") bodyEl.classList.add("dark");

  themeToggle.forEach(btn => {
    btn.onclick = ()=>{
      bodyEl.classList.toggle("dark");
      localStorage.setItem("themeMode", bodyEl.classList.contains("dark") ? "dark":"light");
      lucide.replace({width:20, height:20});
    };
  });

  // AUTH LOGIC
  const authScreen = document.getElementById("authScreen");
  const dashScreen = document.getElementById("dashScreen");
  const dashWelcome = document.getElementById("dashWelcome");

  const tabRegBtn = document.getElementById("tabRegBtn");
  const tabLoginBtn = document.getElementById("tabLoginBtn");
  const regForm = document.getElementById("regForm");
  const loginForm = document.getElementById("loginForm");

  const genTokenBtn = document.getElementById("genTokenBtn");
  const regStatus = document.getElementById("regStatus");
  const regTokenShow = document.getElementById("regTokenShow");
  const copyTokenBtn = document.getElementById("copyTokenBtn");
  const downloadTokenBtn = document.getElementById("downloadTokenBtn");

  const loginTokenInput = document.getElementById("loginTokenInput");
  const loginBtn = document.getElementById("loginBtn");
  const loginStatus = document.getElementById("loginStatus");

  let savedToken = localStorage.getItem("userToken");
  let savedUsername = localStorage.getItem("username");

  function makeUsername(){
    const prefixes=["swift","roblox","altsagent"];
    const prefix=prefixes[Math.floor(Math.random()*prefixes.length)];
    const num=Math.floor(10000+Math.random()*90000);
    return `${prefix}${num}`;
  }

  function showScreen(s){
    authScreen.classList.remove("active");
    dashScreen.classList.remove("active");
    document.getElementById(s).classList.add("active");
  }

  // AUTO LOGIN IF TOKEN
  if(savedToken){
    showScreen("dashScreen");
    dashWelcome.textContent = `Logged in as ${savedUsername}`;
  }

  tabRegBtn.onclick = ()=>{
    regForm.style.display="block";
    loginForm.style.display="none";
    tabRegBtn.classList.add("btn-primary");
    tabLoginBtn.classList.remove("btn-primary");
  };
  tabLoginBtn.onclick = ()=>{
    regForm.style.display="none";
    loginForm.style.display="block";
    tabLoginBtn.classList.add("btn-primary");
    tabRegBtn.classList.remove("btn-primary");
  };

  genTokenBtn.onclick = async ()=>{
    const username=makeUsername();
    regStatus.textContent="Getting token...";
    try{
      // call backend
      const res=await fetch("/api/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username})});
      const data=await res.json();
      if(!res.ok) throw new Error(data.error||"Register failed");
      savedToken=data.token;
      savedUsername=data.username;
      localStorage.setItem("userToken", savedToken);
      localStorage.setItem("username", savedUsername);

      regTokenShow.value=data.token;
      regTokenShow.style.display="block";
      copyTokenBtn.disabled=false;
      downloadTokenBtn.disabled=false;
      regStatus.textContent="Token generated!";
      dashWelcome.textContent=`Logged in as ${savedUsername}`;

    }catch(e){
      regStatus.textContent=`Error: ${e.message}`;
    }
  };

  copyTokenBtn.onclick = ()=>navigator.clipboard.writeText(regTokenShow.value);
  downloadTokenBtn.onclick = ()=>{
    const blob=new Blob([regTokenShow.value],{type:"text/plain"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="token.txt";
    a.click();
    URL.revokeObjectURL(a.href);
  };

  loginBtn.onclick = async ()=>{
    const token=loginTokenInput.value.trim();
    loginStatus.textContent="Checking...";
    try{
      const res=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token})});
      const data=await res.json();
      if(!res.ok) throw new Error(data.error||"Login failed");
      savedToken=token;
      savedUsername=data.username;
      localStorage.setItem("userToken", savedToken);
      localStorage.setItem("username", savedUsername);
      dashWelcome.textContent=`Logged in as ${savedUsername}`;
      showScreen("dashScreen");
    }catch(e){
      loginStatus.textContent=`Error: ${e.message}`;
    }
  };

  // FILE STORAGE (localStorage)
  const fileListUI=document.getElementById("fileList");
  const dropZone=document.getElementById("dropZone");
  const fileInput=document.getElementById("fileInput");
  let storedFiles=JSON.parse(localStorage.getItem("files"))||[];

  function refreshFiles(){
    fileListUI.innerHTML="";
    storedFiles.forEach(f=>{
      const li=document.createElement("li");
      const icon=document.createElement("i");
      icon.setAttribute("data-lucide", f.name.endsWith(".py")?"pyramid":"file-archive");
      li.appendChild(icon);
      li.appendChild(document.createTextNode(f.name));
      fileListUI.appendChild(li);
    });
    lucide.replace({width:20,height:20});
  }
  refreshFiles();

  fileInput.onchange=(e)=>{
    const files=[...e.target.files];
    files.forEach(f=>{
      storedFiles.push({name:f.name});
    });
    localStorage.setItem("files", JSON.stringify(storedFiles));
    refreshFiles();
  };

  dropZone.onclick=()=>fileInput.click();
  dropZone.ondragover=(ev)=>{ev.preventDefault();dropZone.classList.add("hover");};
  dropZone.ondragleave=()=>dropZone.classList.remove("hover");
  dropZone.ondrop=(ev)=>{
    ev.preventDefault();dropZone.classList.remove("hover");
    const files=[...ev.dataTransfer.files];
    files.forEach(f=>{storedFiles.push({name:f.name});});
    localStorage.setItem("files",JSON.stringify(storedFiles));
    refreshFiles();
  };

  // DELETE ACCOUNT
  const delAccBtn=document.getElementById("delAccBtn");
  const deleteConfirm = document.getElementById("deleteConfirm");
  const delStatus=document.getElementById("delStatus");

  delAccBtn.onclick=()=>{
    if(deleteConfirm.value.trim()==="Delete Account"){
      localStorage.clear();
      location.reload();
    } else delStatus.textContent="Type exactly 'Delete Account' to confirm";
  };

</script>

</body>
</html>
